---
title: 项目整体搭建和使用技术
---

## 项目整体搭建和使用技术

### 0. 使用的技术

1. react & react-dom：基础核心
2. react-router：路由配置
3. @loadable/component：动态路由加载
4. classnames：更好的 className 写法
5. react-router-config：更好的 react-router 路由配置包
6. redux & react-redux & redux-saga：saga 状态管理
7. eslint & lint-staged & husky & prettier：代码校验配置
8. eslint-config-alloy：ESLint 配置插件

dependencies:

~~~powershell
npm install --save react react-dom react-router @loadable/component classnames react-router-config redux react-redux redux-saga
~~~

devDependencies：

~~~powershell
npm install --save-dev eslint lint-staged husky@4.3.8 prettier
~~~

### 1. 项目的初始化

项目名称为：`history-manager-system-client`
采用的框架为：`vite -- 2.7` 的版本

~~~powershell
npm init @vitejs/app hisotry-manager-system-client --template react-ts    
~~~

### 2. Pre-Commit 校验配置

使用 `npx husky-init` 命令生成 `.husky` 文件夹，并在 `.husky` 在 `pre-commit` 文件中添加如下内容：

~~~code
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npm run lint
~~~

并创建 `commit-msg` 文件，并在 `commit-msg` 文件中添加如下内容：

~~~code
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx --no-install commitlint --edit $1
~~~

最后，在 `package.json` 中添加如下内容：

~~~json
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged"
    }
  },
  "lint-staged": {
    "src/**/*.{ts,tsx}": [
      "eslint --fix",
      "git add"
    ],
    "src/**/*.{js,jsx}": [
      "eslint --fix",
      "git add"
    ]
  },
~~~

并在 `script` 中添加如下内容：

~~~json
"prepare": "husky install"
~~~

### 3. ESLint + Prettier 配置

输入 `npx eslint --init` 命令生成 `.eslintrc` 文件

第一项：

![image-20220124161920625](https://gitee.com/sue201982/mysql/raw/master/img//image-20220124161920625.png)

第二项：

![image-20220124162122253](https://gitee.com/sue201982/mysql/raw/master/img//image-20220124162122253.png)

第三项：

![image-20220124162208892](https://gitee.com/sue201982/mysql/raw/master/img//image-20220124162208892.png)

第四项：

![image-20220124162237523](https://gitee.com/sue201982/mysql/raw/master/img//image-20220124162237523.png)

第五项：

![image-20220124162333841](https://gitee.com/sue201982/mysql/raw/master/img//image-20220124162333841.png)

第六项：

![image-20220124162505894](https://gitee.com/sue201982/mysql/raw/master/img//image-20220124162505894.png)

第七项：

![image-20220124162553150](https://gitee.com/sue201982/mysql/raw/master/img//image-20220124162553150.png)

第八项：

![image-20220124162654951](https://gitee.com/sue201982/mysql/raw/master/img//image-20220124162654951.png)

第九项：

![image-20220124162724874](https://gitee.com/sue201982/mysql/raw/master/img//image-20220124162724874.png)

然后会自动生成 `.eslintrc.js`

~~~js
module.exports = {
  // 为我们提供运行环境，一个环境定义了一组预定义的全局变量
  env: {
    browser: true,
    es2021: true,
    node: true,
  },
  // 一个配置文件可以被基础配置中的已启用的规则继承。
  extends: [
    'plugin:react/recommended',
    'airbnb',
  ],
  // ESLint 默认使用Espree作为其解析器，你可以在配置文件中指定一个不同的解析器
  "parser": "@typescript-eslint/parser",
  // 配置解析器支持的语法
  parserOptions: {
    ecmaFeatures: {
      jsx: true,
    },
    ecmaVersion: 13,
    sourceType: 'module',
  },
  // ESLint 支持使用第三方插件。在使用插件之前，你必须使用 npm 安装它。
  // 在配置文件里配置插件时，可以使用 plugins 关键字来存放插件名字的列表。插件名称可以省略 eslint-plugin- 前缀。
  plugins: [
    'react',
    '@typescript-eslint',
  ],
  // ESLint 附带有大量的规则。你可以使用注释或配置文件修改你项目中要使用的规则。要改变一个规则设置，你必须将规则 ID 设置为下列值之一：
  // "off" 或 0 - 关闭规则
  // "warn" 或 1 - 开启规则，使用警告级别的错误：warn (不会导致程序退出)
  // "error" 或 2 - 开启规则，使用错误级别的错误：error (当被触发的时候，程序会退出)
  rules: {
    "@typescript-eslint/explicit-member-accessibility": "off"
  },
};
~~~

补上对 `react` 版本的配置

~~~json
// .eslintrc
{
  "settings": {
    "react": {
      "version": "detect" // 表示探测当前 node_modules 安装的 react 版本
    }
  }
}
~~~

### 4. 整体目录规划

大致的目录架构如下：

~~~txt
├── assets // 静态资源，会被打包优化
│   ├── favicon.svg
│   └── logo.svg
├── common // 公共配置，比如统一请求封装，session 封装
│   ├── http-client
│   └── session
├── components // 全局组件，分业务组件或 UI 组件
│   ├── Toast
├── config // 配置文件目录
│   ├── index.ts
├── hooks // 自定义 hook
│   └── index.ts
├── layouts // 模板，不同的路由，可以配置不同的模板
│   └── index.tsx
├── lib // 通常这里防止第三方库，比如 jweixin.js、jsBridge.js
│   ├── README.md
├── pages // 页面存放位置
│   ├── Home
│   │   ├── Components
│   │   │   └──  Header.tsx
│   │   └──  HomePage.tsx
├── routes // 路由配置
│   └── index.ts
├── store // 全局状态管理
│   ├── action.ts
│   ├── constants.ts
│   ├── reducer.ts
│   └──  index.ts
├── styles // 全局样式
│   ├── global.less
│   └── reset.less
└── utils // 工具方法
  └── index.ts
├── app.tsx
├── main.tsx
└── vite-env.d.ts
~~~

### 5. 别名配置

别名的配置，我们需要关注的是两个地方：`vite.config.ts & tsconfig.json`

其中 `vite.config.ts` 用来编译识别用的；`tsconfig.json` 是用来给 `Typescript` 识别用的；

这里建议采用的是 `@/` 开头，为什么不用 `@` 开头，这是为了避免跟业界某些 `npm` 包名冲突（例如 `@vitejs`）

- `vite.config.ts`

~~~ts
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import { resolve } from 'path'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
    }
  }
})
~~~

- `tsconfig.json`

~~~json
 "baseUrl": "./",
    "paths": {
      "@/*": [
        "./src/*"
      ]
    },
~~~

### 6. 全局样式

说到样式处理，这里咱们的示例采用的是 .scss 文件，所以在项目里面需要安装对应的解析库

~~~powershell
npm add --save-dev sass-loader node-sass sass
~~~

如果要支持 `css modules` 特性，需要在 `vite.config.ts` 文件中开启对应的配置项：

~~~ts
//  vite.config.ts
{
  css: {
    preprocessorOptions: {
      scss: {
        // 支持内联 JavaScript
        javascriptEnabled: true
      }
    },
    modules: {
      // 样式小驼峰转化, 
      //css: goods-list => tsx: goodsList
      localsConvention: 'camelCase'
    }
  },
}
~~~

### 7. 路由规划（单页面应用）

`src/routes/index.ts`，这里引入的了 `@loadable/component` 库来做路由动态加载，vite 默认支持动态加载特性，以此提高程序打包效率